<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portal Interno | Sono Show</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  
<style>
  /* --- L√ìGICA DE IFRAME --- */
  .is-iframe body { zoom: 0.8; }
  .is-iframe .container { max-width: 100% !important; padding-left: 10px !important; padding-right: 10px !important; min-height: 100vh !important;}

  /* --- SEUS ESTILOS ORIGINAIS --- */
  .nav-link.active { border-bottom: 3px solid #3b82f6; color: #1e293b; font-weight: bold; }
  .card-zoom:hover { transform: translateY(-3px); transition: all 0.3s; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  .animate-fadeIn { animation: fadeIn 0.5s ease-in; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  #carousel-slides { transition: transform 0.5s ease-in-out; }
  .banner-container { height: clamp(150px, 40vh, 400px); width: 100%; }
  body { overflow-x: hidden; }
  .pdf-thumb-canvas { width: 100%; height: auto; }
  .iframe-container { height: calc(100vh - 120px); min-height: 500px; }
  
  @media (max-width: 480px) {
    .container { padding-left: 0.5rem; padding-right: 0.5rem; }
    h2 { font-size: 1.25rem !important; }
    .nav-link { font-size: 8px !important; padding: 0.5rem 0.15rem !important; }
  }
</style>

  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    if (window.self !== window.top) { document.documentElement.classList.add('is-iframe'); }
  </script>
</head>
<body class="bg-gray-100 font-sans">

  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center text-center md:text-left">
      <img src="https://sonoshowmoveis.vtexassets.com/assets/vtex.file-manager-graphql/images/9c25daff-344c-4bbf-9adf-054dba3b5137___c25ce75d1124b3ba71eebaaf2a2527e2.png" alt="Logo" class="h-10 mb-3 md:mb-0" />
      <nav class="flex flex-wrap justify-center gap-2 md:gap-4 text-gray-500 text-[9px] sm:text-xs uppercase tracking-tighter sm:tracking-wider">
        <button onclick="switchTab('home')" class="nav-link active py-2 transition-all" id="btn-home">Home</button>
        <button onclick="switchTab('treinamento')" class="nav-link py-2 transition-all" id="btn-treinamento">Treinamento</button>
        <button onclick="switchTab('rh')" class="nav-link py-2 transition-all" id="btn-rh">RH</button>
        <button onclick="switchTab('encartes')" class="nav-link py-2 transition-all" id="btn-encartes">Encartes</button>
        <button onclick="switchTab('catalogo')" class="nav-link py-2 transition-all text-blue-600 font-bold" id="btn-catalogo">Cat√°logo</button>
        <button onclick="switchTab('sobre')" class="nav-link py-2 transition-all" id="btn-sobre">Sobre N√≥s</button>
        <button onclick="switchTab('faq')" class="nav-link py-2 transition-all" id="btn-faq">FAQ</button>
      </nav>
    </div>
  </header>

  <main id="tab-home" class="tab-content active container mx-auto p-4 animate-fadeIn">
    <div class="relative w-full bg-slate-900 rounded-2xl overflow-hidden shadow-xl border-4 border-white banner-container mb-8">
      <div id="carousel-slides" class="flex h-full w-full"></div>
      <button onclick="moveSlide(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/50 text-white w-10 h-10 rounded-full z-20 flex items-center justify-center"><i class="fas fa-chevron-left"></i></button>
      <button onclick="moveSlide(1)" class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/50 text-white w-10 h-10 rounded-full z-20 flex items-center justify-center"><i class="fas fa-chevron-right"></i></button>
    </div>
    <h3 class="text-xl font-bold text-slate-700 mb-6 flex items-center gap-2 italic"><i class="fas fa-bullhorn text-blue-500"></i> QUADRO DE AVISOS</h3>
    <div id="grid-comunicados" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main>

  <main id="tab-treinamento" class="tab-content container mx-auto p-4 animate-fadeIn">
    <div class="bg-white rounded-2xl shadow-lg p-6 min-h-[500px]">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
        <h2 class="text-2xl font-bold text-slate-800 italic">üìÇ Manuais e Arquivos</h2>
        <div class="relative w-full md:w-64">
           <input type="text" id="fileSearch" placeholder="Buscar manual..." class="w-full bg-gray-100 rounded-lg py-2 pl-10 pr-4 outline-none focus:ring-2 focus:ring-blue-500" />
           <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
      </div>
      <div id="explorer-content" class="divide-y divide-gray-100"></div>
    </div>
  </main>

  <main id="tab-encartes" class="tab-content container mx-auto p-4 animate-fadeIn">
    <h2 class="text-2xl font-bold mb-8 italic flex items-center gap-3 text-slate-800">
      <span class="bg-blue-600 text-white p-2 rounded-lg shadow-md"><i class="fas fa-tags"></i></span> Encartes e Promo√ß√µes Atuais
    </h2>
    <div id="grid-encartes" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8"></div>
  </main>

  <main id="tab-catalogo" class="tab-content container mx-auto p-4 animate-fadeIn">
    <div id="catalogo-wrapper" class="bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col iframe-container"></div>
  </main>

  <main id="tab-sobre" class="tab-content container mx-auto p-4 animate-fadeIn">
    <div class="bg-white rounded-2xl shadow-lg p-8 max-w-4xl mx-auto">
      <div class="text-center mb-10">
        <h2 class="text-3xl font-bold text-slate-800 italic mb-2">Nossa Hist√≥ria</h2>
        <div class="h-1 w-20 bg-blue-600 mx-auto"></div>
      </div>
      <div class="grid md:grid-cols-2 gap-8 items-center">
        <div class="text-gray-600 space-y-4">
          <p>A <strong>Sono Show M√≥veis</strong> nasceu com o objetivo de realizar sonhos, oferecendo conforto e qualidade para o lar das fam√≠lias brasileiras.</p>
          <p>Com anos de tradi√ß√£o no mercado, nossa miss√£o √© proporcionar uma experi√™ncia de compra √∫nica, pautada na confian√ßa e na excel√™ncia do atendimento.</p>
        </div>
        <div class="bg-blue-50 p-6 rounded-xl border-l-4 border-blue-600">
          <h4 class="font-bold text-blue-800 mb-2 uppercase text-sm">Nossos Valores</h4>
          <ul class="text-sm space-y-2 text-blue-900">
            <li><i class="fas fa-check-circle mr-2"></i> √âtica e Transpar√™ncia</li>
            <li><i class="fas fa-check-circle mr-2"></i> Valoriza√ß√£o das Pessoas</li>
            <li><i class="fas fa-check-circle mr-2"></i> Qualidade nos Produtos</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <main id="tab-faq" class="tab-content container mx-auto p-4 animate-fadeIn">
    <div class="max-w-3xl mx-auto">
      <h2 class="text-2xl font-bold text-slate-800 italic mb-8 flex items-center gap-3">
        <i class="fas fa-question-circle text-blue-600"></i> Perguntas Frequentes
      </h2>
      <div class="space-y-4">
        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
          <h4 class="font-bold text-slate-700">Como acesso os manuais de montagem?</h4>
          <p class="text-gray-500 text-sm mt-2">Basta navegar at√© a aba "Treinamento", onde todos os arquivos est√£o organizados por pastas.</p>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
          <h4 class="font-bold text-slate-700">O cat√°logo √© atualizado em tempo real?</h4>
          <p class="text-gray-500 text-sm mt-2">Sim, a aba "Cat√°logo" exibe diretamente a nossa plataforma oficial de produtos.</p>
        </div>
      </div>
    </div>
  </main>

  <main id="tab-rh" class="tab-content container mx-auto p-4 text-center py-20 animate-fadeIn">
    <div class="bg-white p-12 rounded-2xl shadow-lg max-w-2xl mx-auto border-b-8 border-blue-500">
      <i class="fas fa-user-tie text-6xl text-blue-100 mb-6"></i>
      <h2 class="text-3xl font-bold text-gray-700">Espa√ßo do Colaborador</h2>
      <p class="text-gray-500 mt-4 italic">Conte√∫dos de RH em fase de implementa√ß√£o.</p>
    </div>
  </main>

  <script>
    const USER = "jeanmelosonoshow";
    const REPO = "Sono-Show";
    let currentSlide = 0, totalSlides = 0, allFiles = [];
    const loadedTabs = { home: false, treinamento: false, encartes: false, catalogo: false };

    async function generatePdfThumb(url, canvasId) {
      try {
        const loadingTask = pdfjsLib.getDocument(url);
        const pdf = await loadingTask.promise;
        const page = await pdf.getPage(1);
        const viewport = page.getViewport({ scale: 0.4 });
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        await page.render({ canvasContext: context, viewport: viewport }).promise;
      } catch (e) { console.error("Erro miniatura:", e); }
    }

    async function loadHomeData() {
      if(loadedTabs.home) return;
      try {
        const response = await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/main/comunicados.json?t=${Date.now()}`);
        const data = await response.json();
        const carousel = document.getElementById("carousel-slides");
        if (data.banners) {
          totalSlides = data.banners.length;
          carousel.innerHTML = data.banners.map(img => `<div class="min-w-full h-full flex items-center justify-center bg-slate-900"><img src="${img}" class="max-w-full max-h-full object-contain"></div>`).join("");
        }
        document.getElementById("grid-comunicados").innerHTML = data.avisos.map(c => `
          <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-${c.cor}-500 card-zoom">
            <span class="text-[10px] font-bold text-${c.cor}-600 bg-${c.cor}-50 px-2 py-1 rounded uppercase">${c.categoria}</span>
            <h4 class="font-bold text-lg mt-3 text-slate-800 leading-tight">${c.titulo}</h4>
            <p class="text-gray-500 text-sm mt-2">${c.descricao}</p>
            <div class="mt-4 pt-4 border-t border-gray-50 text-[10px] text-gray-400 font-bold uppercase">${c.data}</div>
          </div>`).join("");
        loadedTabs.home = true;
      } catch (e) { console.error(e); }
    }

    async function loadEncartes(path) {
      if(loadedTabs.encartes) return;
      const container = document.getElementById("grid-encartes");
      container.innerHTML = '<p class="col-span-full text-center p-10 text-slate-400 animate-pulse">Carregando encartes...</p>';
      try {
        const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`);
        const data = await res.json();
        let pdfs = data.filter(i => i.name.toLowerCase().endsWith(".pdf"));
        pdfs.sort((a, b) => {
            const getParts = (name) => {
                const parts = name.replace('.pdf', '').split('-');
                return { mes: parseInt(parts[0]) || 0, ano: parseInt(parts[1]) || 0 };
            };
            const dA = getParts(a.name), dB = getParts(b.name);
            return (dB.ano !== dA.ano) ? dB.ano - dA.ano : dB.mes - dA.mes;
        });
        container.innerHTML = pdfs.map((pdf, index) => {
          const canvasId = `pdf-canvas-${index}`;
          const isNew = index === 0;
          setTimeout(() => generatePdfThumb(`https://${USER}.github.io/${REPO}/${pdf.path}`, canvasId), 400);
          return `<div onclick="window.open('https://${USER}.github.io/${REPO}/${pdf.path}', '_blank')" class="relative cursor-pointer group bg-white rounded-xl shadow-md transition-all overflow-hidden border ${isNew ? 'border-amber-400 ring-2 ring-amber-50' : 'border-gray-100'} flex flex-col">
            ${isNew ? '<div class="absolute top-2 right-2 z-10 bg-amber-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-lg animate-bounce">NOVO</div>' : ''}
            <div class="aspect-[3/4] bg-gray-100 flex items-center justify-center"><canvas id="${canvasId}" class="pdf-thumb-canvas"></canvas></div>
            <div class="p-3 bg-white border-t">
              <p class="text-[10px] font-bold ${isNew ? 'text-amber-600' : 'text-gray-400'} uppercase">${isNew ? 'Destaque' : 'Encarte Anterior'}</p>
              <p class="text-xs font-bold text-slate-700 truncate">${pdf.name.replace('.pdf','')}</p>
            </div>
          </div>`;
        }).join("");
        loadedTabs.encartes = true;
      } catch (e) { container.innerHTML = "Erro ao carregar encartes."; }
    }

    // AJUSTE: L√≥gica de navega√ß√£o corrigida
    async function loadFiles(path) {
      try {
        const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${path}`);
        allFiles = await res.json();
        renderFileList(allFiles, path);
        if(path === "Manuais") loadedTabs.treinamento = true;
      } catch (e) { console.error(e); }
    }

    function renderFileList(files, currentPath) {
      const container = document.getElementById("explorer-content");
      // O segredo do bot√£o voltar: se o path n√£o for "Manuais", ele volta para a raiz dos manuais
      let backBtn = currentPath !== "Manuais" ? `
        <div class="p-4 bg-blue-50 text-blue-600 font-bold cursor-pointer border-b flex items-center gap-2 hover:bg-blue-100 transition-colors" onclick="loadFiles('Manuais')">
          <i class="fas fa-arrow-left"></i> Voltar para Manuais
        </div>` : "";
      
      container.innerHTML = backBtn + files.map(item => `
        <div class="flex items-center justify-between py-4 px-6 hover:bg-slate-50 cursor-pointer border-b border-gray-50" onclick="${item.type==='dir' ? `loadFiles('${item.path}')` : `window.open('https://${USER}.github.io/${REPO}/${item.path}','_blank')`}">
          <div class="flex items-center gap-4"><i class="fas ${item.type==='dir'?'fa-folder text-yellow-500':'fa-file-pdf text-red-500'} text-xl"></i><span class="font-medium text-slate-700">${item.name}</span></div>
          <i class="fas fa-chevron-right text-slate-200 text-xs"></i>
        </div>`).join("");
    }

    function switchTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
      document.querySelectorAll(".nav-link").forEach(el => el.classList.remove("active"));
      document.getElementById("tab-" + tabId).classList.add("active");
      document.getElementById("btn-" + tabId).classList.add("active");

      if (tabId === "home") loadHomeData();
      if (tabId === "treinamento") loadFiles("Manuais");
      if (tabId === "encartes") loadEncartes("Encartes");
      if (tabId === "catalogo" && !loadedTabs.catalogo) {
          document.getElementById('catalogo-wrapper').innerHTML = `<iframe src="https://catalogo.sonoshowmoveis.com.br/" class="w-full h-full border-none"></iframe>`;
          loadedTabs.catalogo = true;
      }
    }

    function moveSlide(direction) {
      const slides = document.getElementById("carousel-slides");
      if (totalSlides === 0) return;
      currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
      slides.style.transform = `translateX(-${currentSlide * 100}%)`;
    }

    window.onload = () => {
      loadHomeData();
      setInterval(() => { if(document.getElementById('tab-home').classList.contains('active')) moveSlide(1); }, 6000);
    };
  </script>
</body>
</html>
